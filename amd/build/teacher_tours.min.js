/**
 * JavaScript for handling tour creation via button click.
 *
 * @module block_teacher_tours/teacher_tours
 * @copyright 2025 Your Name <your.email@example.com>
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_teacher_tours/teacher_tours",["jquery","core/ajax","core/str"],(function($,Ajax,Str){let tourObject={steps:[],name:"",description:"",pathmatch:"",enabled:"",filter_values:"",sortorder:""},stickyTarget=null,sticky=!1,currentStepObject={};const startEditor=function(){$("#start-tour-creation").hide(),$("#start-sticky-creation").hide(),$("#step-creation").hide(),$("#tour-editor").show(),sticky?highlightPlacements():highlightElements()},showCurrentStepIndicator=function(elementText){$("#current-step-element").text(elementText),$("#current-step-indicator").show()},showTourStepsPreview=function(){$(".tour-preview").html(""),tourObject.steps.forEach(((step,index)=>{$(".tour-preview").append('<div class="tour-step-preview" data-step-index="'+index+'">Step '+(index+1)+" <strong> "+step.targetvalue+":</strong> "+step.title+' <i class="fa fa-pencil edit-step-icon" style="float: right; cursor: pointer; margin-left: 10px;"></i></div>')})),$(".tour-preview").show()},hideCurrentStepIndicator=function(){$("#current-step-indicator").hide()},resetCurrentStepObject=function(){currentStepObject={}},hexToRgba=function(hex,opacity){return hex=hex.replace(/^#/,""),`rgba(${parseInt(hex.substring(0,2),16)}, ${parseInt(hex.substring(2,4),16)}, ${parseInt(hex.substring(4,6),16)}, ${opacity})`},init_styles=function(){const colors=window.teachertoursColors,style=document.createElement("style"),moduleHighlightopacity03=hexToRgba(colors.moduleHighlight,.3),moduleHighlightopacity05=hexToRgba(colors.moduleHighlight,.5),sectionHighlightopacity03=hexToRgba(colors.sectionHighlight,.3),sectionHighlightopacity05=hexToRgba(colors.sectionHighlight,.5);style.textContent=`\n                /* Tour creation highlighting */\n                .module-highlight {\n                    background-color: ${moduleHighlightopacity03};\n                    border: 1px solid ${colors.moduleHighlight};\n                    cursor: pointer;\n                    transition: all 0.3s ease;\n                    border-radius: 1rem;\n                }\n                .module-highlight:hover {\n                    background-color: ${moduleHighlightopacity05};\n                    transform: scale(1.02);\n                }\n                .section-highlight {\n                    background-color: ${sectionHighlightopacity03};\n                    border: 1px solid ${colors.sectionHighlight};\n                    cursor: pointer;\n                    transition: all 0.3s ease;\n                    border-radius: 1rem;\n                }\n\n                .section-highlight:hover {\n                    background-color: ${sectionHighlightopacity05};\n                    transform: scale(1.02);\n                }\n\n                /* Tour Preview Styling */\n                .tour-preview {\n                    margin-bottom: 20px;\n                    background-color: #fff;\n                }\n\n                .tour-step-preview {\n                    display: flex;\n                    align-items: center;\n                    padding: 10px 15px;\n                    margin-bottom: 8px;\n                    background-color: #f8f9fa;\n                    border: 1px solid #e9ecef;\n                    border-radius: 6px;\n                    border-left: 4px solid ${colors.moduleHighlight};\n                    font-size: 14px;\n                    transition: all 0.2s ease;\n                }\n\n                .tour-step-preview:hover {\n                    background-color: #e9ecef;\n                    transform: translateX(2px);\n                }\n\n                .tour-step-preview:last-child {\n                    margin-bottom: 0;\n                }\n\n                .tour-step-preview strong {\n                    color: #495057;\n                    margin-right: 8px;\n                }\n\n                .tour-step-preview .edit-step-icon {\n                    color: #6c757d;\n                    transition: color 0.2s;\n                    margin-left: auto;\n                }\n\n                    .tour-step-preview .edit-step-icon:hover {\n                    color: #007bff;\n                    cursor: pointer;\n                }\n\n                /* Instructions Styling */\n                .editor-instructions {\n                    background-color: #e7f3ff;\n                    border: 1px solid #b8daff;\n                    border-radius: 6px;\n                    padding: 12px 16px;\n                    margin-bottom: 20px;\n                    color: ${colors.moduleHighlight};\n                    font-size: 14px;\n                    display: flex;\n                    align-items: center;\n                }\n\n                .editor-instructions::before {\n                    content: "ðŸ’¡";\n                    margin-right: 10px;\n                    font-size: 16px;\n                }\n\n                /* Current Step Indicator */\n                .current-step-indicator .alert {\n                    margin-bottom: 15px;\n                    border-left: 4px solid #17a2b8;\n                }\n\n                /* Add Step Button Container */\n                .add-step-container {\n                    text-align: center;\n                    padding: 20px;\n                    border: 2px dashed #dee2e6;\n                    border-radius: 8px;\n                    background-color: #f8f9fa;\n                    margin-top: 15px;\n                }\n\n                .add-step-container:hover {\n                    border-color: ${colors.moduleHighlight};\n                    background-color: #e7f3ff;\n                }\n\n                /* Text Editor Styling */\n                .text-editor {\n                    margin-top: 20px;\n                    padding: 20px;\n                    border: 1px solid #dee2e6;\n                    border-radius: 8px;\n                    background-color: white;\n                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n                }\n\n                .text-editor-header {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    margin-bottom: 20px;\n                    padding-bottom: 15px;\n                    border-bottom: 1px solid #dee2e6;\n                }\n\n                /* Tour Cards Styling */\n                .tour-list {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 15px;\n                    margin-bottom: 20px;\n                }\n\n                .tour-card {\n                    background: white;\n                    border: 1px solid #dee2e6;\n                    border-radius: 8px;\n                    padding: 16px;\n                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n                    transition: all 0.2s ease;\n                }\n\n                .tour-card:hover {\n                    border-color: ${colors.moduleHighlight};\n                    box-shadow: 0 4px 8px rgba(0, 123, 255, 0.15);\n                    transform: translateY(-1px);\n                }\n\n                .tour-card-header {\n                    margin-bottom: 12px;\n                }\n\n                .tour-info {\n                    flex: 1;\n                    margin-right: 20px;\n                }\n\n                .tour-name {\n                    font-size: 16px;\n                    font-weight: 600;\n                    color: #343a40;\n                    margin: 0 0 8px 0;\n                    line-height: 1.3;\n                }\n\n                .tour-description {\n                    color: #6c757d;\n                    font-size: 14px;\n                    margin: 0;\n                    line-height: 1.4;\n                    max-width: 400px;\n                }\n\n                .tour-controls {\n                    display: flex;\n                    justify-content: space-between;\n                    flex-shrink: 0;\n                }\n\n                .form-switch {\n                padding-top: .25rem;\n                    margin-bottom: 0;\n                }\n\n                .form-switch .form-check-input {\n                    width: 2.5em;\n                    height: 1.25em;\n                }\n\n                .form-switch .form-check-label {\n                    font-size: 13px;\n                    margin-left: 10px;\n                    color: #6c757d;\n                }\n\n                .tour-toggle:checked+.form-check-label .enabled-text {\n                }\n\n                .tour-toggle:not(:checked)+.form-check-label .enabled-text {\n                    display: none;\n                }\n\n                .tour-toggle:checked+.form-check-label .disabled-text {\n                    display: none;\n                }\n\n                .tour-card-footer {\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    border-top: 1px solid #f8f9fa;\n                }\n\n                .tour-status {\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                    font-size: 13px;\n                }\n                \n                .tour-actions {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 12px;\n                }\n\n                /* Empty state for no tours */\n                .existing-tours:empty::before {\n                    content: "No tours created yet. Click 'Create New Tour' to get started.";\n                    display: block;\n                    text-align: center;\n                    color: #6c757d;\n                    font-style: italic;\n                    padding: 40px 20px;\n                    background: #f8f9fa;\n                    border-radius: 8px;\n                    border: 2px dashed #dee2e6;\n                }\n\n                .btn.btn-sm.btn-outline-primary.section-sticky-highlight {\n                    border-style: dashed;\n                    position: absolute;\n                    top: -0.5rem;\n                    right: -0.5rem;\n                    background: white;\n                }\n\n                .btn.btn-sm.btn-outline-primary.section-sticky-highlight:hover {\n                    color: inherit;\n                }\n \n                .btn.btn-sm.btn-outline-primary.section-sticky-button {\n                    border-style: solid;\n                    position: absolute;\n                    top: -0.5rem;\n                    right: -0.5rem;\n                    background: white;\n                }\n \n                .btn.btn-sm.btn-outline-primary.section-sticky-button:hover {\n                    color: inherit;\n                }\n \n                .btn.btn-sm.btn-outline-primary.header-sticky-highlight {\n                    border-style: dashed;\n                    position: absolute;\n                    top: 0;\n                    right: 0;\n                    background: white;\n                }\n \n                .btn.btn-sm.btn-outline-primary.header-sticky-button {\n                    border-style: solid;\n                    position: absolute;\n                    top: 0;\n                    right: 0;\n                    background: white;\n                }\n \n                .btn.btn-sm.btn-outline-primary.header-sticky-highlight:hover {\n                    color: inherit;\n                }\n \n                .btn.btn-sm.btn-outline-primary.header-sticky-button:hover {\n                    color: inherit;\n                }\n \n            `,document.head.appendChild(style)},tourEventHandlers_stickySelectClick=function(e){e.preventDefault(),e.stopPropagation();const element=e.currentTarget;element.classList.contains("section-sticky-highlight")?(element.classList.remove("section-sticky-highlight"),element.classList.add("section-sticky-button"),Str.get_string("selectplacement","block_teacher_tours").then((function(text){element.html(text)}))):element.classList.contains("header-sticky-highlight")&&(element.classList.remove("header-sticky-highlight"),element.classList.add("header-sticky-button"),Str.get_string("selectplacement","block_teacher_tours").then((function(text){element.html(text)})));let parent=element.parentElement;stickyTarget=parent.getAttribute("id"),removeHighlighting(),sticky=!1,highlightElements()},tourEventHandlers_stickyStartClick=function(e){e.preventDefault(),e.stopPropagation();let customtourid=e.currentTarget.dataset.customtourid;Ajax.call([{methodname:"block_teacher_tours_create_tour_from_custom",args:{courseid:customtourid}}])[0].then((function(response){console.log(response),response||"ok"!==!response.status||alert("Error saving tour: "+(response.message||"Unknown error")),window.location.reload()}))},tourEventHandlers_sectionClick=function(e){e.preventDefault(),e.stopPropagation();const section=e.currentTarget;currentStepObject={targettype:"0",targetvalue:"#"+section.getAttribute("id"),placement:"right",orphan:"false",backdrop:"true",reflex:"false"},showCurrentStepIndicator("Section: "+section.getAttribute("data-sectionname")),removeHighlighting(),startTextEditor()},tourEventHandlers_moduleClick=function(e){e.preventDefault(),e.stopPropagation();const mod=e.currentTarget;currentStepObject={targettype:"0",targetvalue:"#"+mod.getAttribute("id"),placement:"right",orphan:"false",backdrop:"true",reflex:"false"},showCurrentStepIndicator("Module: "+mod.childNodes[1].getAttribute("data-activityname")),removeHighlighting(),startTextEditor()},highlightElements=function(){document.querySelectorAll('[id^="section-"]').forEach((section=>{section.classList.add("section-highlight"),section.addEventListener("click",tourEventHandlers_sectionClick)})),document.querySelectorAll('[id^="module-"]').forEach((mod=>{mod.classList.add("module-highlight"),mod.addEventListener("click",tourEventHandlers_moduleClick)}))},setPlacements=function(placementid,customtourid){Str.get_string("touravailable","block_teacher_tours").then((function(text){placementid.startsWith("section-")?document.querySelectorAll('[id="'+placementid+'"]').forEach((section=>{const button=document.createElement("button");button.dataset.customtourid=customtourid,button.className="btn btn-sm btn-outline-primary section-sticky-button",button.textContent=text+" ";const icon=document.createElement("i");icon.className="fa fa-question-circle",button.append(icon),section.style.position="relative",section.prepend(button),button.addEventListener("click",tourEventHandlers_stickyStartClick)})):"page-header"===placementid&&document.querySelectorAll('[id="page-header"]').forEach((header=>{const button=document.createElement("button");button.dataset.customtourid=customtourid,button.className="btn btn-sm btn-outline-primary header-sticky-button",button.textContent=text+" ";const icon=document.createElement("i");icon.className="fa fa-question-circle",button.append(icon),header.style.position="relative",header.prepend(button),button.addEventListener("click",tourEventHandlers_stickyStartClick)}))}))},highlightPlacements=function(){Str.get_string("selectplacement","block_teacher_tours").then((function(text){document.querySelectorAll('[id^="section-"]').forEach((section=>{const button=document.createElement("button");button.className="btn btn-sm btn-outline-primary section-sticky-highlight",button.textContent=text+" ";const icon=document.createElement("i");icon.className="fa fa-question-circle",button.append(icon),section.style.position="relative",section.prepend(button),button.addEventListener("click",tourEventHandlers_stickySelectClick)})),document.querySelectorAll('[id="page-header"]').forEach((mod=>{const button=document.createElement("button");button.className="btn btn-sm btn-outline-primary header-sticky-highlight",button.textContent=text+" ";const icon=document.createElement("i");icon.className="fa fa-question-circle",button.append(icon),mod.style.position="relative",mod.prepend(button),button.addEventListener("click",tourEventHandlers_stickySelectClick)}))}))},startTextEditor=function(){let editIndex=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;$("#text-editor").show(),null===editIndex&&clearTextEditor(),$("#save-tour").hide(),$("#step-title").focus(),$("#text-editor").data("edit-index",editIndex)},clearTextEditor=function(){$("#step-title").val(""),$("#step-content").val("")},removeHighlighting=function(){sticky?(document.querySelectorAll(".section-sticky-highlight").forEach((section=>{section.remove()})),document.querySelectorAll(".header-sticky-highlight").forEach((mod=>{mod.remove()}))):(document.querySelectorAll('[id^="section-"]').forEach((section=>{section.classList.remove("section-highlight"),section.removeEventListener("click",tourEventHandlers_sectionClick)})),document.querySelectorAll('[id^="module-"]').forEach((mod=>{mod.classList.remove("module-highlight"),mod.removeEventListener("click",tourEventHandlers_moduleClick)})))},saveTour=function(){$("#save-tour").prop("disabled",!0).text("Saving...");let argsObj={};stickyTarget?(tourObject.placementid=stickyTarget,tourObject.custom=!0,argsObj={tour:tourObject}):(tourObject.custom=!1,argsObj={tour:tourObject}),Ajax.call([{methodname:"block_teacher_tours_save_tour",args:argsObj}])[0].then((function(response){console.log(response),response||"ok"!==!response.status||alert("Error saving tour: "+(response.message||"Unknown error")),resetTourObject(),$("#tour-editor").hide(),$("#start-tour-creation").show(),$("#start-sticky-creation").show(),$("#step-creation").show(),hideCurrentStepIndicator(),clearTextEditor(),removeHighlighting(),$(".tour-preview").html(""),$(".tour-preview").hide(),Str.get_string("savetour","block_teacher_tours").then((function(text){$("#save-tour").prop("disabled",!1).html('<i class="fa fa-save"></i> '+text)}))}))},resetTourObject=function(courseid){stickyTarget=null,sticky=!1,tourObject={steps:[],name:"tour for course "+courseid,description:"A tour for course "+courseid,pathmatch:"/course/view.php?id="+courseid,enabled:"",filter_values:"",sortorder:""}},addStep=function(stepData){tourObject.steps.push(stepData||{})},saveStep=function(){const title=$("#step-title").val(),content=$("#step-content").val(),editIndex=$("#text-editor").data("edit-index");null!=editIndex?(tourObject.steps[editIndex].title=title,tourObject.steps[editIndex].content=content,showTourStepsPreview(),clearTextEditor(),$("#text-editor").hide(),$("#save-tour").show(),$("#text-editor").data("edit-index",null)):(currentStepObject.title=title,currentStepObject.content=content,addStep(currentStepObject))},initializeEventBindings=function(){$(document).on("click","#start-tour-creation",(function(e){e.preventDefault(),startEditor()})),$(document).on("click","#start-sticky-creation",(function(e){e.preventDefault(),sticky=!0,startEditor()})),$(document).on("click","#save-tour",(function(e){e.preventDefault(),saveTour()})),$(document).on("click","#save-step",(function(e){e.preventDefault(),saveStep(),$("#text-editor").hide(),$("#save-tour").show(),showTourStepsPreview(),hideCurrentStepIndicator(),resetCurrentStepObject(),startEditor()})),$(document).on("click",".edit-step-icon",(function(e){e.preventDefault(),e.stopPropagation();!function(stepIndex){if(stepIndex<tourObject.steps.length){const step=tourObject.steps[stepIndex];$("#step-title").val(step.title),$("#step-content").val(step.content),startTextEditor(stepIndex),$("#save-tour").hide(),currentStepObject={targettype:step.targettype,targetvalue:step.targetvalue,placement:step.placement,orphan:step.orphan,backdrop:step.backdrop,reflex:step.reflex},showCurrentStepIndicator("Editing: "+step.targetvalue)}}($(this).parent().data("step-index"))})),$(document).on("click","#cancel-step-edit",(function(e){e.preventDefault(),hideCurrentStepIndicator(),resetCurrentStepObject(),$("#text-editor").hide(),startEditor()})),$(document).on("click","#cancel-tour-creation",(function(e){e.preventDefault(),$("#tour-editor").hide(),$("#start-sticky-creation").show(),$("#start-tour-creation").show(),hideCurrentStepIndicator(),resetTourObject(),$(".tour-preview").html(""),$(".tour-preview").hide()})),$(document).on("click","#step-creation",(function(){startEditor()})),$(document).on("change",".tour-toggle",(function(){!function(tourId,enabled){Ajax.call([{methodname:"block_teacher_tours_toggle_tour_enabled",args:{tourid:tourId,enabled:enabled}}])[0].done((function(response){if(response.success){const tourCard=$(`[data-tour-id="${tourId}"]`),statusElement=tourCard.find(".tour-status");response.enabled?(Str.get_string("enabled","block_teacher_tours").then((function(enabledText){statusElement.html('<i class="fa fa-check-circle text-success"></i> '+enabledText)})),tourCard.find(".tour-toggle").prop("checked",!0)):(Str.get_string("disabled","block_teacher_tours").then((function(disabledText){statusElement.html('<i class="fa fa-times-circle text-muted"></i> '+disabledText)})),tourCard.find(".tour-toggle").prop("checked",!1))}else $(`[data-tour-id="${tourId}"]`).find(".tour-toggle").prop("checked",!enabled),alert("Failed to update tour status. Please try again.")})).fail((function(){$(`[data-tour-id="${tourId}"]`).find(".tour-toggle").prop("checked",!enabled),alert("Error updating tour status. Please try again.")}))}($(this).data("tour-id"),$(this).is(":checked"))})),$(document).on("click",".edit-tour",(function(e){e.preventDefault();!function(tourId){alert("Edit functionality will be implemented when backend is ready. Tour ID: "+tourId)}($(this).data("tour-id"))})),$(document).on("click",".delete-tour",(function(e){e.preventDefault();!function(tourId){confirm("Are you sure you want to delete this tour? This action cannot be undone.")&&Ajax.call([{methodname:"block_teacher_tours_delete_tour",args:{tourid:tourId}}])[0].done((function(response){response.success?$(`[data-tour-id="${tourId}"]`).fadeOut(300,(function(){$(this).remove(),0===$(".tour-card").length&&$(".existing-tours").hide()})):alert("Failed to delete tour. Please try again.")})).fail((function(){alert("Error deleting tour. Please try again.")}))}($(this).data("tour-id"))}))};return{sticky:sticky,currentStepObject:currentStepObject,tourObject:tourObject,init:function(courseid,customTours){init_styles(),initializeEventBindings(),Object.values(customTours).forEach((tour=>{console.log("tour",tour),setPlacements(tour.placementid,courseid)})),resetTourObject(courseid)},startEditor:startEditor,resetTourObject:resetTourObject,addStep:addStep,saveStep:saveStep,saveTour:saveTour,startTextEditor:startTextEditor,highlightElements:highlightElements,initializeEventBindings:initializeEventBindings}}));

//# sourceMappingURL=teacher_tours.min.js.map